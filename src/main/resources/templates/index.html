<!DOCTYPE html>
<html dir="ltr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Tell the browser to be responsive to screen width -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Favicon icon -->
    <link rel="icon" type="image/png" sizes="16x16" href="assets/images/favicon.png">
    <title>合众艾特信息技术有限公司满意度评定系统</title>
    <link href="assets/extra-libs/c3/c3.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="assets/libs/bootstrap-switch/dist/css/bootstrap3/bootstrap-switch.min.css">
    <link href="dist/css/style.min.css" rel="stylesheet">
</head>

<body>
<div id="main-wrapper">
    <!-- ============================================================== -->
    <!-- 开始引入头部模版-->
    <!-- ============================================================== -->
    <header class="topbar" th:replace="moban::head"></header>

    <!-- ============================================================== -->
    <!-- 引入左边菜单部分-->
    <!-- ============================================================== -->
    <aside class="left-sidebar" th:replace="moban::as"></aside>

    <!-- ============================================================== -->
    <!-- 页面主题部分  -->
    <!-- ============================================================== -->
    <div class="page-wrapper">
        <!-- ============================================================== -->
        <!-- Container fluid  -->
        <!-- ============================================================== -->
        <div class="container-fluid">
            <!-- ============================================================== -->
            <!-- 页面上方提示部分  -->
            <!-- ============================================================== -->
            <div class="row">
                <div class="col-lg-12">
                    <div class="card  bg-light no-card-border">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="m-r-10">
                                    <img src="assets/images/users/8.jpg" alt="user" width="60" class="rounded-circle"/>
                                </div>
                                <div>
                                    <h3 class="m-b-0">Welcome back!</h3>
                                    <span>Monday, 9 March 2019</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ============================================================== -->
            <!-- 图表区域 -->
            <!-- ============================================================== -->
            <div class="card-group">
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-12">
                                <h3><th:block th:text="${masterscore}"></th:block>%</h3>
                                <h6 class="card-subtitle"><th:block th:text="${#dates.year(date)}"></th:block>年教务团队满意度</h6>
                            </div>
                            <div class="col-12">
                                <div class="progress">
                                    <div class="progress-bar bg-success" role="progressbar"
                                         style="width:85%; height: 6px;" aria-valuenow="25" aria-valuemin="0"
                                         aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-12">
                                <h3><th:block th:text="${teacherscore}"></th:block>%</h3>
                                <h6 class="card-subtitle"><th:block th:text="${#dates.year(date)}"></th:block>讲师团队满意度</h6>
                            </div>
                            <div class="col-12">
                                <div class="progress">
                                    <div class="progress-bar bg-info" role="progressbar" th:style="'width:'+${teacherscore}+'%'"
                                         aria-valuenow="25" aria-valuemin="0"
                                         aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-12">
                                <h3><th:block th:text="${total}"></th:block></h3>
                                <h6 class="card-subtitle">参与投票总次数</h6>
                            </div>
                            <div class="col-12">
                                <div class="progress">
                                    <div class="progress-bar bg-danger" role="progressbar"
                                         style="width: 100%; height: 6px;" aria-valuenow="25" aria-valuemin="0"
                                         aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- ============================================================== -->
            <!-- place order / Exchange -->
            <!-- ============================================================== -->
            <div class="row">
                <div class="col-lg-4">
                    <div class="card bg-cyan text-white">
                        <div class="card-body">
                            <div class="d-flex">
                                <div class="m-r-20 align-self-center">
                                    <h1 class="text-white">
                                        <i class="ti-pie-chart"></i>
                                    </h1>
                                </div>
                                <div>
                                    <h4 class="card-title">满意度趋势对比</h4>
                                </div>
                            </div>
                            <div class="row m-t-20 align-items-center">
                                <div class="col-12 text-right">
                                    <div class="spark-count" style="height:275px" id="chart2"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="col-lg-8">
                    <div class="card">
                        <div class="card-body">
                            <h4>
                                <div class="input-group" style="width:360px;">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">查看</span>
                                    </div>
                                    <select class="form-control custom-select" id="selectyear">
                                        <option th:value="${year}" th:each="year : ${#numbers.sequence(2017,2027)}" th:selected="${year}==${#dates.year(date)}"><th:block th:text="${year}"></th:block>年</option>
                                    </select>
                                    <select class="form-control custom-select" id="selectmonth">
                                        <option th:value="${month}" th:each="month : ${#numbers.sequence(1,12)}" th:selected="${month}==${#dates.month(date)}"><th:block th:text="${month}"></th:block>月</option>
                                    </select>
                                <div class="input-group-prepend">
                                    <span class="input-group-text">讲师教务满意度</span>
                                </div>
                            </div></h4>
                            <div id="income" class="m-t-30" style="width: 100%;height:285px"></div>
                        </div>
                    </div>

                </div>

            </div>
            <!-- ============================================================== -->
            <!-- project of the month -->
            <!-- ============================================================== -->
            <div class="row">
                <div class="col-sm-12 col-lg-12">
                    <div class="card">
                        <div class="card-body p-b-0">
                            <div class="row">
                                <div class="col-sm-12 col-lg-4">
                                    <h2 class="card-title">
                                        满意度得分列表
                                    </h2>
                                </div>
                                <div class="col-sm-9 col-lg-2">
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">选择身份</span>
                                        </div>
                                        <select class="form-control custom-select">
                                            <option>全部</option>
                                            <option value="AK">讲师</option>
                                            <option value="HI">教务</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-sm-9 col-lg-2">
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">人员名字</span>
                                        </div>
                                        <input type="text" class="form-control">
                                    </div>
                                </div>
                                <div class="col-sm-9 col-lg-3">
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">选择时间:</span>
                                        </div>
                                        <select class="form-control custom-select">
                                            <option value="2021" th:each="y:${#numbers.sequence(2017,2025)}" th:value="${y}"><th:block th:text="${y}"></th:block></option>
                                        </select>
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">年</span>
                                        </div>
                                        <select class="form-control custom-select">
                                            <option value="5" th:each="m:${#numbers.sequence(1,12)}" th:value="${m}"><th:block th:text="${m}"></th:block>月</option>

                                        </select>

                                    </div>
                                </div>
                                <div class="col-sm-9 col-lg-1">
                                    <button type="submit" class="btn btn-primary" style="width: 80%">查询</button>
                                </div>
                            </div>

                            <div class="table-responsive">
                                <table class="table v-middle">
                                    <thead>
                                    <tr>
                                        <th class="border-top-0">被评论人</th>
                                        <th class="border-top-0">班级</th>
                                        <th class="border-top-0">得分</th>
                                        <th class="border-top-0">时间</th>
                                        <th class="border-top-0" style="text-align: center" >详情</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="p:${commentdata.content}">
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="m-r-10">

                                                </div>
                                                <div class="">
                                                    <h4 class="m-b-0 font-16" th:text="${p.codPeople}"></h4>
                                                </div>
                                            </div>
                                        </td>
                                        <td th:text="${p.comClass}">Elite Admin</td>
                                        <td class="font-medium" th:text="${p.comScore}" >35</td>
                                        <td class="font-medium" th:text="${p.comTime}" >35</td>

                                        <td align="center"> <button type="button" class="btn waves-effect waves-light btn-info">查看详情</button></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="row">
                <div class="col-sm-12 col-md-5">
                    <div class="dataTables_info" id="DataTables_Table_0_info" role="status" aria-live="polite">
                        Showing 1to 10 of 57 entries
                    </div>
                </div>
                <div class="col-sm-12 col-md-7">
                    <div class="dataTables_paginate paging_simple_numbers" id="DataTables_Table_0_paginate">
                        <ul class="pagination">
                            <li class="paginate_button page-item previous disabled" id="DataTables_Table_0_previous">
                                <a href="#" class="page-link">上一页</a></li>
                            <li class="paginate_button page-item active">
                                <a href="#"  tabindex="0"  class="page-link">1</a>
                            </li>
                            <li class="paginate_button page-item ">
                                <a href="#" class="page-link">2</a>
                            </li>
                            <li class="paginate_button page-item ">
                                <a href="#" class="page-link">3</a>
                            </li>
                            <li class="paginate_button page-item ">
                                <a href="#" class="page-link">4</a>
                            </li>
                            <li class="paginate_button page-item next" id="DataTables_Table_0_next">
                                <a href="#" class="page-link">下一页</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- ============================================================== -->
            <!-- Task, Feeds -->
            <!-- ============================================================== -->


        </div>
        <!-- ============================================================== -->
        <!-- Trade history / Exchange -->
        <!-- ============================================================== -->
    </div>
    <!-- ============================================================== -->
    <!-- End Container fluid  -->
    <!-- ============================================================== -->
    <!-- ============================================================== -->
    <!-- footer -->
    <!-- ============================================================== -->
    <footer class="footer text-center" th:replace="moban::foot"></footer>
    <!-- ============================================================== -->
    <!-- End footer -->
    <!-- ============================================================== -->
</div>
<!-- ============================================================== -->
<!-- End Page wrapper  -->
<!-- ============================================================== -->
</div>
<!-- ============================================================== -->
<!-- End Wrapper -->


<div class="chat-windows"></div>
<!-- ============================================================== -->
<!-- All Jquery -->
<!-- ============================================================== -->
<script src="assets/libs/jquery/dist/jquery.min.js"></script>
<!-- Bootstrap tether Core JavaScript -->
<script src="assets/libs/popper.js/dist/umd/popper.min.js"></script>
<script src="assets/libs/bootstrap/dist/js/bootstrap.min.js"></script>
<!-- apps -->
<script src="dist/js/app.min.js"></script>
<!-- Theme settings -->
<script src="dist/js/app.init.js"></script>
<script src="dist/js/app-style-switcher.js"></script>
<!-- slimscrollbar scrollbar JavaScript -->
<script src="assets/libs/perfect-scrollbar/dist/perfect-scrollbar.jquery.min.js"></script>
<script src="assets/extra-libs/sparkline/sparkline.js"></script>
<!--Wave Effects -->
<script src="dist/js/waves.js"></script>
<!--Menu sidebar -->
<script src="dist/js/sidebarmenu.js"></script>
<!--Custom JavaScript -->
<script src="dist/js/custom.min.js"></script>
<!--This page JavaScript -->
<!--c3 JavaScript -->
<script src="assets/libs/echarts/echarts.min.js"></script>
<script src="assets/extra-libs/c3/d3.min.js"></script>
<script src="assets/extra-libs/c3/c3.min.js"></script>

<script>
var myChart,char2;
function resize() {
        setTimeout(function() {
            console.log("1111111111");
            // Resize chart
            myChart.resize();
        }, 200);
 }

 function loadTeacherChart(){
     $.post("searchallavg",function(data){
         var a=new Array();
         a[0]=new Array(); //教员
         a[1]=new Array();  //教务
         a[2]=new Array(); //时间
         for(var i=0;i<data.length;i++){
             if(data[i].commodule=='教员'){
                 a[2].push(data[i].t);
                 a[0].push(data[i].avgscore);
             }else if(data[i].commodule=="教务"){
                 a[1].push(data[i].avgscore);
             }
         }
         var char2 = echarts.init(document.getElementById('chart2'));
           var  option = {
                 tooltip: {
                     trigger: 'axis'
                 },
               legend: {
                   data:['讲师','教务']
               },
                 grid: {
                     left: -1,
                     right: 0,
                     bottom: 0,
                     top:0,
                     containLabel: false
                 },
                 xAxis: {
                     type: 'category',
                     boundaryGap: false,
                     data:a[2],
                     splitLine:{
                         show:false
                     }
                 },
                 yAxis: {
                     type: 'value',
                     splitLine:{
                         show:false
                     },
                     max: 100,
                     min: 80,
                 },
                 series: [
                     {
                         name:'讲师',
                         type:'line',
                         stack: '讲师',
                         data:a[0]
                     },
                     {
                         name:'教务',
                         type:'line',
                         stack: '教务',
                         data:a[1]
                     }
                 ]
             };
         char2.setOption(option);

     });
     $.post("searchallavg",{typename:"教务"},function(data){
         $('.bandwidth').sparkline(
             data,
             {
                 type: 'bar',
                 width: '100%',
                 height: '70',
                 barWidth: '2',
                 resize: true,
                 barSpacing: '6',
                 barColor: 'rgba(255, 255, 255, 0.3)'
             }
         );
     })
 }
 function loadAvgChart(v_time) {
     $.post("searchAvgByMonth",{time:v_time},function(data){
         var seriesdata=new Array();
         var xAxisData=new Array();
         var countdata=new Array();
         for(var i=0;i<data.length;i++){
             seriesdata.push(data[i].score);
             xAxisData.push(data[i].codPeople);
             countdata.push(data[i].c);
         }
         myChart = echarts.init(document.getElementById('income'));
         // 指定图表的配置项和数据
         var option = {
             color:['#4798e8','#ffbc34', '#4798e8', '#AABBCC'],
             grid: {
                 left: '1%',
                 right: 50,
                 top: 50,
                 bottom: '3%',
                 containLabel: true
             },
             tooltip : {
                 trigger: 'axis'
             },

             xAxis: {

                 data: xAxisData
             },
             yAxis: [
         {
             type: 'value',
             scale: true,
             name: '满意度得分',
             max: 100,
             min: 0,
             boundaryGap: [0.2, 0.2]
         },
         {
             type: 'value',
             scale: true,
             name: '参与人数',
             max: 40,
             min: 0,
             boundaryGap: [0.2, 0.2]
         }
             ],
             series: [{
                 name: '满意度得分',
                 type: 'bar',
                 data: seriesdata,
                 markPoint : {
                     data : [
                         {type : 'max', name: 'Max'},
                         {type : 'min', name: 'Min'}
                     ]
                 },
                 markLine : {
                     data : [
                         {type : 'average', name: 'Average'}
                     ]
                 }
             }, {
                     name:'参与人数',
                     type:'line',
                     data:countdata
                 }]
         };
         // 使用刚指定的配置项和数据显示图表。
         myChart.setOption(option);
     })

 }


    $(document).ready(function() {
        $(window).on('resize', resize);
        $(".sidebartoggler").on('click', resize);
        var t=new Date();
        loadAvgChart(t.getFullYear()+"-"+(t.getMonth()+1));
        loadTeacherChart();

        $("#selectmonth").change(function(){
            loadAvgChart($("#selectyear").val()+"-"+$(this).val());
        })
    });



</script>
</body>

</html>